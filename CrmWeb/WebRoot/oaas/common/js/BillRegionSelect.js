function page_onLoad(){
	initRegion();
}
function initRegion(){
	var parameter = window.dialogArguments[0];
 	var queryResult = null ;
	var ajaxCall = new NDAjaxCall(true); 
	
	var callBack = function( reply ){
		queryResult = reply.getResult() ; 
		regionTreeView.loadByXML(queryResult );
	}
	
	/**
	 *??????????????????????.????????????????regionLevel????,????????????????????????????????????
	 *????,????????????????????regionLevel??????????????,????????????????????????????????????????
	 *????.????????????regionLevel????????????,??????????????????????????,????????????????????????
	 *??????????????????????,????????????????????????????.
	**/
	//ajaxCall.remoteCall("RegionService","getRegionByCond", arr, callBack); 
	ajaxCall.remoteCall("RegionService","getBillRegionList",["-1"],callBack);
}

function clickRegion(){
	var selItem = regionTreeView.selectedItem ;
	if( selItem == null ){
		return ;
	}
	if( selItem.items ){
		return ;
	}
	
	var selLevel = selItem.regionLevel ;
	
	var parameter = window.dialogArguments[0];
	var privCode =  parameter["privilegeCode"];//????????
	var regionLevel = parameter["regionLevel"]; //????????????

	regionLevel = "98D";
	if( selLevel == regionLevel ){
		return ;
	}
	if( regionLevel == "98F" ){//????
		if( selLevel == "98E" ){
			downloadSubRegions( privCode ) ;//??????????????????????????
		}else {
			downloadSubRegions() ;//??????????????????????????,????????????????????????????
		}
	}
	
	if( regionLevel == "98E" ){//????
		if( selLevel == "98D" ){
			downloadSubRegions( privCode ) ;//??????????????????????????
		}else {
			downloadSubRegions() ;//??????????????????????????,????????????????????????????
		}
	}
	
	if( regionLevel == "98D" ){//????
		if( selLevel == "97D" ){
			downloadSubRegions( privCode ) ;//??????????????????????????
		}else {
			downloadSubRegions() ;//??????????????????????????,????????????????????????????
		}
	}	
		
	if( regionLevel == "97D" ){//??????
		if( selLevel == "97B" ){
			downloadSubRegions( privCode ) ;//??????????????????????????
		}else {
			downloadSubRegions() ;//??????????????????????????,????????????????????????????
		}
	}

	if( regionLevel == "97B" ){//??????
		if( selLevel == "97E" ){
			downloadSubRegions( privCode ) ;//??????????????????????????
		}else {
			downloadSubRegions() ;//??????????????????????????,????????????????????????????
		}	
	}
		
	if( regionLevel == "97E" ){//??????
		if( selLevel == "97A" ){
			downloadSubRegions( privCode ) ;//??????????????????????????
		}else {
			downloadSubRegions() ;//??????????????????????????,????????????????????????????
		}			
	}
	
	if( regionLevel == "97A" ){//??????
		downloadSubRegions( privCode ) ;//??????????????????????????
	}
}

function downloadSubRegions(privCode){
	var selItem = regionTreeView.selectedItem ;
	if( selItem == null ){
		return ;
	}
	if( selItem.items ){
		return ;
	}
	
	var ajaxCall = new NDAjaxCall( true ) ;
	
	var callBack = function( reply ){
		var result = reply.getResult() ;
		if( result != "<items/>" ){
			selItem.insertByXML( result ) ;
			selItem.expand(true);
		}
	}
	
	var regionId = selItem.regionId ;
	if( privCode == null || privCode == "" || privCode == "undefined" ){
		ajaxCall.remoteCall("RegionService","getResourceRegionList",[regionId], callBack);
	}else{
		ajaxCall.remoteCall("RegionService","getFilteredResourceRegionList",[regionId,privCode], callBack);
	}
}

function btn_Confirm_onClick(){
	var regionArray = new Array();
	var items = regionTreeView.checkedItems;
	for( var i = 0; i < items.length ; i ++ ){
		var parameter = window.dialogArguments[0];
		var regionLevel = parameter["regionLevel"]; //????????????
		if( items[i].regionLevel != regionLevel ){
			if( regionLevel == "97A" ){
				alert("????????????????!");
				return ;
			}
			if( regionLevel == "97E" ){
				alert("??????????????!");
				return ;
			}
			if( regionLevel == "97B" ){
				alert("??????????????!");
				return ;
			}
			if( regionLevel == "97D" ){
				alert("??????????????!");
				return ;
			}
			if( regionLevel == "98D" ){
				alert("??????????????!");
				return ;
			}
			if( regionLevel == "98E????" ){
				alert("????????!");
				return ;
			}
			if( regionLevel == "98F" ){
				alert("????????????!");
				return ;
			}
		}
		regionArray[i] = items[i].regionId ;
	}
	window.returnValue = regionArray.join(",");
	window.close();
}

function btn_Cancel_onClick(){
	window.returnValue = "" ;
	window.close();
}

function Parameter(){
	this.staffCode = "";
	this.privilegeCode = "";
	this.regionLevel = "";
	this.regionType = "";
	this.regionIds = "";
	this.checkBox = "";
}

//????????????check box??????????
function regionChecked(){
	var selItem = regionTreeView.selectedItem;
	var parentItem = getRegionItemById( selItem.parentRegionId ) ;
	if( parentItem != null ){
		uncheckParentItem( selItem ) ;//??????????????????????????
	}
	if( selItem.getChecked()){
		uncheckChildren( selItem ) ;//??????????????????????????
	}
}

//??????????????????????????????
function uncheckChildren( item ){
	if( item.items != null ){
		for( var i = 0 ; i < item.items.length ; i ++ ){
			var child = item.items[i] ;
			child.setChecked( false ) ;
			uncheckChildren( child ) ;
		}
	}
}

//????????????????????????????????
function uncheckParentItem( item ){
	var parentItem = null ;
	parentItem = getRegionItemById( item.parentRegionId ) ;
	if( parentItem != null ){
		parentItem.setChecked( false ) ;
		uncheckParentItem( parentItem ) ;
	}
}
function getRegionItemById( regionId ){
	for( var i = 0; i < regionTreeView.items.length; i ++ ){
		var item = regionTreeView.items[i] ;
		if( item.regionId == regionId ){
			return item ;
		}
	}
}