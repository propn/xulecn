<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; GBK">
		<title></title>
		<script type="text/javascript" src="../../../public/components/environment.js"></script>
		<script>
/**
功能说明:current_fileprefix
计算当前页面的相对路径前缀字符串.
主要考虑因素是本地运行和服务器端运行的差异

要求以crmweb为站点名, 在该站点内部的目录不能再以"crmweb"命名
 **/
function setCookie(sName, sValue)
{
  var myDate=new Date();
	myDate.setMonth(myDate.getMonth()+1);
  document.cookie = sName + "=" + escape(sValue) + "; expires=" + myDate.toGMTString();
}
function getCookie(sName)
{
	var aCookie = document.cookie.split("; ");
	for (var i=0; i < aCookie.length; i++)
	{
		var aCrumb = aCookie[i].split("=");
		if (sName == aCrumb[0])
		return unescape(aCrumb[1]);
	}
	return null;
}

var themeId = getCookie("themeId");

if(!themeId){
  themeId = "bsn";
}


var path_prefix = "";
var onService = false;
var webroot = SystemContext.appWebRoot;

var oldDataset = new Array();

var pathname = location.pathname.substring(1);
if (pathname.indexOf('/') >  - 1)
{
  onService = true;
  pathname = pathname.substring(pathname.indexOf('/') + 1);
  var path_array = pathname.split("/");
  for (var i = 0; i < path_array.length - 1; i++)
    path_prefix += "../";
}
else
{
  onService = false;
  pathname = pathname.substring(pathname.lastIndexOf(webroot) + webroot.length);
  var path_array = pathname.split("\\");
  for (var i = 0; i < path_array.length - 1; i++)
    path_prefix += "../";
}

</script>
		<script language="JavaScript" src="messageBox.js" charset="GBK"></script>
	</head>
	<style type="text/css">
/*定义界面主体包括（字体、边距、滚动条样式）*/
body { 
    font-family: "arial", "helvetica", "sans-serif", ""; 
	font-size: 9pt; 
    margin: 0px;
	scrollbar-face-color:#efefe7;
    scrollbar-highlight-color:#ffffff;
    scrollbar-3dlight-color:#a5a5a5;
    scrollbar-darkshadow-color:#a5a5a5;
    scrollbar-shadow-color:#d6d6ce;
    scrollbar-arrow-color:#003184;
    scrollbar-track-color:#deded6;
	}
/*表格缺省样式*/
table { 
    font-family: "arial", "helvetica", "sans-serif",""; 
	font-size: 9pt; 
	line-height: 150%; 
	color: #000000;
	 }
	 
.nextButton{float:right;FILTER: progid:DXImageTransform.Microsoft.Gradient(GradientType=0, StartColorStr=#ffffff, EndColorStr=#CEDAEE);}

/**按钮组合样式**/
/*初始状态 */ 
.button
    {
	border-bottom: #596CA5 1px solid;
	border-left: #8596CA 1px solid;
	border-right: #596CA5 1px double;
	border-top: #8596CA 1px solid;
	padding-left: 6px;
	padding-right: 6px;
	font-size:9pt;
	text-align:center;
	vertical-align:top;
	height:19px;
	cursor:pointer;
	background-image: url(../../skins/bsn/messageBox/button_fill_up.gif);
	status:expression(
						onmouseover == null?
							(onmouseover = function()
							{
								this.style.borderRight=this.style.borderBottom = "solid 1px #CE6B00";
								this.style.borderLeft=this.style.borderTop = "solid 1px #FFB56B";
								this.style.backgroundImage="url(../../skins/bsn/messageBox/button_fill_up.gif)";
							}):true,
						onmouseout == null?
							(onmouseout = function()
							{
								if(this.gotFocus)
								{
									this.style.borderLeft=this.style.borderTop = "solid 1px #5198dd";
									this.style.borderRight = this.style.borderBottom = "solid 1px #003074";
								}
								else
								{
									this.style.borderRight=this.style.borderBottom = "solid 1px #596CA5";
									this.style.borderLeft=this.style.borderTop = "solid 1px #8596CA";
								}
								this.style.backgroundImage="url(../../skins/bsn/messageBox/button_fill_up.gif)";
							}):true,
						onfocus == null?
							(onfocus = function()
							{
								this.gotFocus = true;
								this.style.borderLeft=this.style.borderTop = "solid 1px #5198dd";
								this.style.borderRight = this.style.borderBottom = "solid 1px #003074";
							}):true,
						onblur == null?
							(onblur = function()
							{
								this.gotFocus = false;
								this.style.borderRight=this.style.borderBottom = "solid 1px #596CA5";
								this.style.borderLeft=this.style.borderTop = "solid 1px #8596CA";
							}):true,
						onmousedown == null?
							(onmousedown = function()
							{
								this.style.borderRight=this.style.borderBottom = "solid 1px #CE6B00";
								this.style.borderLeft=this.style.borderTop = "solid 1px #FFB56B";
								this.style.backgroundImage="url(../../skins/bsn/messageBox/button_fill_down.gif)";								
							}):true,
						onmouseup == null?
							(onmouseup = function()
							{
								this.style.borderRight=this.style.borderBottom = "solid 1px #CE6B00";
								this.style.borderLeft=this.style.borderTop = "solid 1px #FFB56B";
								this.style.backgroundImage="url(../../skins/bsn/messageBox/button_fill_up.gif)";
							}):true,
						this.setDisable?
							(disabled?(this.className="buttonforbid"):false,this.setDisable=true):true
					);
    }
</style>
	<script language="javascript">

	self.buttons = new Array();
	//jspTaglibErrors
	var errorArray = null;
	var nr=0;
	var errIndex=1;
	var errCount=1;
	
	function PageLoad()
	{
		var caption = dialogArguments.userArgs.caption;
		caption = caption == null?"":caption;

		var text = dialogArguments.userArgs.text;
		text = text == null?"":text;
		var icon = dialogArguments.userArgs.icon;
		icon = icon == null?"":icon;

		var buttons = dialogArguments.userArgs.buttons;
		buttons = buttons == null?"": MessageBoxButtons[buttons];

		var defaultButton = dialogArguments.userArgs.defaultButton;
		defaultButton = defaultButton == null?0:defaultButton;

		var info = dialogArguments.userArgs.info;
		if(info != null)
		{
			var text = "[" + info.actionName + "]\n";
			text += "成功："+info.successCounts+"记录，失败："+info.failCounts+"记录";
			var infoList = document.getElementById("infoList");
			
			var msg = "";
			for (var i = 0; i < info.objectList.length; i++)
			{	
				msg += "[" + info.actionName + "] ";
				msg += info.objectList[i].modelName + "(" +info.objectList[i].modelCode + ")<br>";
				if(info.objectList[i].failReason != null) msg += info.objectList[i].failReason;
				else msg += "操作成功!";
				msg += "<br>";
			}
			
			infoList.value = msg;
		}

		self.document.body.innerHTML = self.document.body.innerHTML
										.replace(/\{\$text\}/g,text)
										.replace(/\{\$icon\}/g,icon)
										.replace(/\{\$buttons\}/g,buttons)
										.replace(/\{\$caption\}/g,caption);
		
		var buttonList = document.getElementById("_buttons").childNodes;

		for (var i = 0; i < buttonList.length; i++)
		{
			if(buttonList[i].name == "__msgbox_button") self.buttons.push(buttonList[i]);
		}
		self.document.body.style.display = "block";
		self.focus();
		self.buttons[defaultButton].focus();
		self.buttons.activeButton = defaultButton;
				
		//log
		var logInfo = dialogArguments.userArgs.log;		
		if(logInfo!=null){
			
			document.getElementById("infoList").value = logInfo;
			//open stackInfo
			//MessageBoxAction.MB_Log();
		}
		
		//jspTaglibErrors
		errorArray = dialogArguments.userArgs.jspTaglibErrors;
		if(errorArray!=null){
						
			if(errorArray.length ){
				errButtons.style.display = "";	
				errPilot.style.display = "";
				errCount=errorArray.length;
			}
			
			showError();
			//open stackInfo
			//MessageBoxAction.MB_Log();
		}
		
		
	}
	function KeyUp()
	{
		if(event.keyCode == 27)
			MessageBoxAction.MB_Cancel();
		else if(event.keyCode == 13)
			self.buttons[self.buttons.activeButton].click();
		else if(event.keyCode == 9)
		{
			self.buttons.activeButton = (++self.buttons.activeButton) % self.buttons.length;
			self.buttons[self.buttons.activeButton].focus();
			return false;
		}
	}
	
	function showNext() {
		if(errorArray == null)return false;
		if(errorArray.length){
			nr=Math.min(errorArray.length-1,nr+1);
		}else{
			nr=0;
		}
	   	errIndex=nr+1;
	   	showError();
	}
	function showPrevious() {
		if(errorArray == null)return false;
	   	nr=Math.max(0,nr-1);
	   	errIndex=nr+1;
	   	showError();
	}

	function showError() {
		errPilot.innerHTML = " 共"+errCount+"条  第"+errIndex+"条 ";
	   	if(errorArray.length && errorArray.length>0){
			alertText.innerHTML = "错误代码: "+errorArray[nr].errorCode+"<br> 错误信息: "+errorArray[nr].errorMessage;
			document.getElementById("infoList").value = errorArray[nr].stackInfo;				
		}
	}
			
  window.attachEvent("onload", PageLoad);
</script>
	<body bgcolor="E7E7E7" style="overflow:hidden" style="display:none" onkeyup="KeyUp()">
		<table width="429" border="0" cellspacing="0" cellpadding="0">
			<tr>
				<td width="150" valign="top" background="../../skins/bsn/messageBox/info_fill.gif">
					<img id="_icon" src="{$icon}" width="150" height="138">
				</td>
				<td valign="top" background="../../skins/bsn/messageBox/info_fill.gif" style="padding-top:28px;padding-right:10px;">
						<table width="100%" border="0" cellspacing="0" cellpadding="0">
							<tr>
								<td>
								<div id="alertText" style="position:absolute;overflow:auto;height:120;width:100%">
									{$text}
								</div>
								</td>
							</tr>
						</table>
				</td>
			</tr>
		</table>
		<table width="429" border="0" cellspacing="0" cellpadding="0">
			<tr>
				<td background="../../skins/bsn/messageBox/info_compart2.gif" width="2px"></td>
			</tr>
		</table>
		<table width="429" border="0" cellpadding="0" cellspacing="0">
			<tr>
				
				<td  align="right" bgcolor="E7E7E7" style="padding:10px;">
					<span id="errPilot" style="display:none"></span>
				</td>
				<td align="right" bgcolor="E7E7E7" style="padding:10px;">					
					<div id="errButtons" style="display:none">
					<table border="0" cellspacing="0" cellpadding="0">
						<tr id="_next_buttons" >
							<td width='14'>&nbsp;</td>
							<td align='center' name='__pre_button' class='button' onclick='showPrevious()' width='50px' >
								上一条

							</td>
							<td width='14'>&nbsp;</td>
							<td align='center' name='__next_button' class='button' onclick='showNext()' width='50px' >
								下一条

							</td>
						</tr>
					</table>	
					</div>				
				</td>
				
				<td align="right" bgcolor="E7E7E7" style="padding:10px;">			
					<table border="0" cellspacing="0" cellpadding="0">
						<tr id="_buttons">
							{$buttons}
						</tr>
					</table>
				</td>
			</tr>
		</table>
		<textarea align=center id="infoList" style="height:248;width:100%;overflow:auto;border:thin inset;background:#E3E3E3;text-align:left">


		</textarea>		

	</body>
</html>